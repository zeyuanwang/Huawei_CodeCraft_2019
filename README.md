# Huawei_CodeCraft_2019 
## 2019年华为软件精英挑战赛

## 题目介绍：
### 题目定义：
&emsp;&emsp;在模拟的道路图上为每一辆车规划行驶路线，系统会自动根据规划路线运行。在路线合法的前提下，最终所有车辆按照规划的路线到达目的地。

### 系统假定：
**1.路口完全立交：**  
&emsp;&emsp;假定在每一个路口交汇的所有道路都可以完全互连，且车辆通过路口时不考虑在路口的通行时间。


**2.无限神奇车库：**  
&emsp;&emsp;假定系统中的每个地点都有一个无限容量的“神奇车库”。车辆在未到既定出发时间前，或者到达目的后，就停放在“神奇车库”中，完全不影响其他车辆通过。但车辆一旦出发，在行驶过程中则不允许进入车库空间。

### 约束条件：
**1.不允许超车变道：**  
&emsp;&emsp;即车辆一旦进入某条车道，就必须在此车道内从道路起点驶向道路终点，中途不允许变道，即使前车速度缓慢，也不允许超车。


**2.排队先到先行：**  
&emsp;&emsp;在一条道路前排队等待的所有车辆，按照到达时间先后进入道路。若多辆车在同一时间到达，按如下规则进入下一道路：  
（1）同一道路牌车道号小（车道的编号）的车辆优先于车道号大的车辆；  
（2）按现实交通规则，直行车辆有优先通行权，直行车辆优先于转弯车辆；  
（3）处于左转进入道路的车辆优先于右转进入道路的车辆。


**3.车道固定进入：**  
&emsp;&emsp;车辆在进入一段道路时按照车道编号从小到大的优先级选择可以进入的车道驶入，与前车的行驶速度无关。即就是：车辆优先按车道编号由小到大依次进入，除非车道号小的车道没有空位可进入。


**4.（仅复赛）优先车辆有优先通行权：**  
&emsp;&emsp;优先车辆比非优先车辆有优先通行权，要求优先保证优先车辆的路权。


**5.（仅复赛）预置车辆：**  
&emsp;&emsp;预置车辆的行驶轨迹由系统指定车辆的出发时间和行驶线路。参赛选手在此基础上计算非预置车辆的行驶轨迹。


### 题目输入：
&emsp;&emsp;每一个测试用例都分为四部分：


**1.道路：**  
&emsp;&emsp;road.txt，每条道路数据表示为(道路id, 道路长度, 最高限速, 车道数目, 起始点id, 终点id, 是否双向)格式的向量。


**2.车辆：**  
&emsp;&emsp;car.txt，每辆车数据表示为(车辆id, 始发地, 目的地, 最高速度, 计划出发时间)格式的向量，复赛每辆车数据表示为(车辆id, 始发地, 目的地, 最高速度, 计划出发时间, 是否优先, 是否预置)格式的向量。


**3.路口信息：**  
&emsp;&emsp;cross.txt，每个路口数据表示为(结点id, 行驶路线序列)格式的向量。路口信息数据向量中的道路id，以路口为中心，其所连接的道路id按顺时针方向编排。


**4.（仅复赛）预置车辆行驶轨迹信息：**  
&emsp;&emsp;presetAnswer.txt，每一辆预置车的行驶路线规划表示为(车辆id, 实际出发时间, 行驶路线序列)格式的向量。


### 答案提交：
&emsp;&emsp;answer.txt，文件中每行数据表示每一辆车的行驶路线规划，具体格式为(车辆id, 实际出发时间, 行驶路线序列)格式的向量。


### 评分规则：
**1.系统调度时间短者胜出。**  
&emsp;&emsp;系统调度时间指，从系统调度开始时间（非第一辆车实际开始运行的时间），至所有车辆全部到达目的地的时间，两者之差作为系统调度时间。在优先车辆参与调度的系统中，最终调度时间为：系统调度开始至所有车辆到达终点所需时间 + 系数因子a * 最早的优先车辆计划时间至所有优先车辆全部到达终点的时间，最终总调度时间为：每辆车辆从计划出发时间至该辆车的到达时间总和 + 系数因子b * 每辆优先车辆从计划出发时间至该辆优先车辆的到达时间总和。系数因子只与系统输入的数据规模有关，与系统外其他因素无关。


**2.若系统调度时间相同，则所有车辆的行驶用时总时间最少者胜出。**  
&emsp;&emsp;一辆车在系统计算中达到目的地的时间点减去其最初计划出发的时间点，称为这辆车的行驶用时。


## 解题思路：
### 初赛：  
&emsp;&emsp;初赛时，我们没有写判题器，主要思路是先给出每辆车的出发时间，再根据出发时间的预计路况，动态改变路径权重寻找路径。


&emsp;&emsp;我们对所有车辆按照速度（逆序）、预计出发时间和车辆id进行排序，以此作为车辆出发顺序。我们设定每秒出发的车辆数为一个线性递减的函数，并在此基础上与三角函数叠加产生一定波动。


&emsp;&emsp;车辆路线的规划主要基于Dijkstra最短路径算法，路径权值考虑了道路长度、车辆在道路上的速度以及道路宽度。为了减少车辆转弯，路线中的每一次左转或右转均会增加一定的权重。为了考虑道路拥堵情况，对于已经发出的车辆，在其预计行驶到一条路时，会对该条道路的权重产生一定的影响，由于预计行驶到的位置并不精确，我们又对该影响增加了一定的“拖尾效应”。


### 复赛：
&emsp;&emsp;复赛时，为了弥补初赛时对路况估计的不精确，我们首先写了判题器，使得能够精准地得到道路实时路况。复赛的主要思路是先给出每一辆非预置车辆的最优路线，然后按照一定的顺序发车，使正在道路上行驶的车辆总数能稳定在一个数字附近。


&emsp;&emsp;车辆路线的规划仍然基于Dijkstra最短路径算法，路径权值考虑了道路长度、车辆在道路上的速度以及车辆转弯情况。


&emsp;&emsp;我们选取了预置车辆中，预置路线的权重总值与最优路线的权重总值相差最大的10%的车辆，并将其路线变更为最优路线。


&emsp;&emsp;车辆发车顺序和发车时间的规划主要分两个阶段进行。第一阶段为有预置车辆发车的阶段，车辆按照优先级、最优路线的实时拥堵情况以及车辆id进行排序，道路上的车辆总数维持在一较低数量水平上。第二阶段为无预置车辆发车的阶段，车辆按照优先级、车辆速度（逆序）、最优路线的实时拥堵情况以及车辆id进行排序，道路上的车辆总数维持在一较高数量水平上。
    
    
## 程序运行方法：
